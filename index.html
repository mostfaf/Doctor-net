<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>دكتور نت لحلول الشبكات - حجز الدعم الفني</title>
  <style>
    /* --- Reset and base styles --- */
    * {
      box-sizing: border-box;
    }
    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: #f0f4f8;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      color: #333;
    }
    h1, h2, h3 {
      margin: 0 0 15px 0;
      font-weight: 700;
      color: #004d99;
    }
    a {
      color: #004d99;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    button {
      cursor: pointer;
      background: #004d99;
      color: white;
      border: none;
      padding: 10px 18px;
      border-radius: 5px;
      font-weight: 600;
      transition: background 0.3s ease;
    }
    button:hover {
      background: #003366;
    }
    input, select, textarea {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border: 1.5px solid #ccc;
      border-radius: 5px;
      font-size: 1rem;
      transition: border-color 0.3s ease;
    }
    input:focus, select:focus, textarea:focus {
      border-color: #004d99;
      outline: none;
    }
    .container {
      max-width: 900px;
      margin: 30px auto;
      background: white;
      padding: 25px 30px 40px 30px;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    }
    /* --- Tabs --- */
    .tabs {
      display: flex;
      justify-content: center;
      margin-bottom: 25px;
      gap: 15px;
    }
    .tab {
      padding: 10px 25px;
      border-radius: 30px;
      background: #e1e9f8;
      color: #004d99;
      font-weight: 600;
      user-select: none;
      transition: background 0.3s ease, color 0.3s ease;
    }
    .tab.active {
      background: #004d99;
      color: white;
      box-shadow: 0 4px 10px rgba(0,77,153,0.4);
    }
    /* --- Form styles --- */
    label {
      font-weight: 600;
      margin-bottom: 6px;
      display: block;
    }
    .small-text {
      font-size: 0.85rem;
      color: #666;
      margin-top: -10px;
      margin-bottom: 15px;
    }
    /* --- Status badges --- */
    .status-badge {
      padding: 6px 14px;
      border-radius: 20px;
      font-weight: 700;
      font-size: 0.85rem;
      display: inline-block;
      min-width: 90px;
      text-align: center;
      color: white;
    }
    .status-pending {
      background-color: #f0ad4e;
    }
    .status-completed {
      background-color: #5cb85c;
    }
    .status-deleted {
      background-color: #d9534f;
    }
    /* --- Table styles --- */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    th, td {
      padding: 12px 10px;
      border-bottom: 1px solid #ddd;
      text-align: center;
    }
    th {
      background-color: #004d99;
      color: white;
    }
    tr:hover {
      background-color: #f5faff;
    }
    /* --- Footer --- */
    footer {
      text-align: center;
      padding: 15px 10px;
      background: #004d99;
      color: white;
      font-size: 0.9rem;
      user-select: none;
    }
    footer a {
      color: #a9d1ff;
      font-weight: 700;
    }
    /* --- Responsive --- */
    @media (max-width: 600px) {
      .tabs {
        flex-direction: column;
        gap: 10px;
      }
      button {
        width: 100%;
      }
    }
  </style>
</head>
<body>

  <div class="container">
    <h1>دكتور نت لحلول الشبكات</h1>
    <p style="color:#555; margin-bottom: 30px;">لحجز طلبات الدعم الفني بسهولة وسرعة</p>

    <div class="tabs">
      <div class="tab active" id="tab-book">حجز طلب جديد</div>
      <div class="tab" id="tab-track">متابعة الطلب</div>
      <div class="tab" id="tab-admin">لوحة الإدارة</div>
    </div>

    <!-- حجز طلب جديد -->
    <section id="section-book">
      <form id="bookingForm">
        <label for="name">الاسم الكامل:</label>
        <input type="text" id="name" name="name" required placeholder="أدخل اسمك الكامل" />

        <label for="phone">رقم الهاتف:</label>
        <input type="tel" id="phone" name="phone" required placeholder="أدخل رقم هاتفك" pattern="^\+?\d{7,15}$" title="رقم هاتف صالح" />

        <label for="email">البريد الإلكتروني (اختياري):</label>
        <input type="email" id="email" name="email" placeholder="example@mail.com" />

        <label for="issue">وصف المشكلة:</label>
        <textarea id="issue" name="issue" rows="4" required placeholder="صف مشكلتك بالتفصيل"></textarea>

        <button type="submit">حجز الطلب</button>
      </form>
    </section>

    <!-- متابعة الطلب -->
    <section id="section-track" style="display:none;">
      <form id="trackForm">
        <label for="trackingNumber">أدخل رقم الحجز لمتابعة الطلب:</label>
        <input type="text" id="trackingNumber" name="trackingNumber" required placeholder="رقم الحجز" />
        <button type="submit">متابعة</button>
      </form>
      <div id="trackingResult" style="margin-top:20px; font-weight: 600;"></div>
    </section>

    <!-- لوحة الإدارة -->
    <section id="section-admin" style="display:none;">
      <form id="adminLoginForm">
        <label for="adminPassword">كلمة مرور لوحة الإدارة:</label>
        <input type="password" id="adminPassword" required placeholder="ادخل كلمة المرور" />
        <button type="submit">دخول</button>
      </form>

      <div id="adminPanel" style="display:none; margin-top:20px;">
        <h2>لوحة إدارة الطلبات</h2>
        <table id="ordersTable">
          <thead>
            <tr>
              <th>رقم الحجز</th>
              <th>الاسم</th>
              <th>الهاتف</th>
              <th>الوصف</th>
              <th>الحالة</th>
              <th>تغيير الحالة</th>
              <th>حذف</th>
            </tr>
          </thead>
          <tbody>
            <!-- الطلبات ستظهر هنا -->
          </tbody>
        </table>
        <button id="logoutBtn" style="margin-top:15px; background:#d9534f;">تسجيل خروج</button>
      </div>
    </section>
  </div>

  <footer>
    برعاية <a href="#">سيستم سمارت راديوس</a> | حقوق النشر &copy; مصطفى عاطف الشوري
  </footer>

  <script>
    // --- بيانات الطلبات مخزنة في localStorage ---
    const STORAGE_KEY = "doctorNetOrders";

    // --- عناصر الصفحة ---
    const tabBook = document.getElementById("tab-book");
    const tabTrack = document.getElementById("tab-track");
    const tabAdmin = document.getElementById("tab-admin");

    const sectionBook = document.getElementById("section-book");
    const sectionTrack = document.getElementById("section-track");
    const sectionAdmin = document.getElementById("section-admin");

    const bookingForm = document.getElementById("bookingForm");
    const trackForm = document.getElementById("trackForm");
    const trackingResult = document.getElementById("trackingResult");

    const adminLoginForm = document.getElementById("adminLoginForm");
    const adminPasswordInput = document.getElementById("adminPassword");
    const adminPanel = document.getElementById("adminPanel");
    const ordersTableBody = document.querySelector("#ordersTable tbody");
    const logoutBtn = document.getElementById("logoutBtn");

    // --- كلمة مرور لوحة الإدارة ---
    const ADMIN_PASSWORD = "admin54321";

    // --- حالة الطلب ---
    const STATUS_PENDING = "قيد التنفيذ";
    const STATUS_COMPLETED = "مكتمل";
    const STATUS_DELETED = "محذوف";

    // --- تخزين واسترجاع الطلبات ---
    function getOrders() {
      const data = localStorage.getItem(STORAGE_KEY);
      return data ? JSON.parse(data) : [];
    }
    function saveOrders(orders) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(orders));
    }

    // --- توليد رقم حجز فريد ---
    function generateBookingNumber() {
      // رقم عشوائي 6 أرقام مع تاريخ مختصر
      const datePart = new Date().toISOString().slice(2,10).replace(/-/g,""); // YYMMDD
      const randomPart = Math.floor(100000 + Math.random() * 900000);
      return datePart + randomPart;
    }

    // --- تحويل الطلب إلى واتساب ---
    function sendToWhatsApp(order) {
      const waNumber = "201064496440";
      const text = encodeURIComponent(
        `طلب دعم فني جديد\n` +
        `رقم الحجز: ${order.bookingNumber}\n` +
        `الاسم: ${order.name}\n` +
        `الهاتف: ${order.phone}\n` +
        `البريد: ${order.email || "-"}\n` +
        `الوصف: ${order.issue}`
      );
      const url = `https://wa.me/${waNumber}?text=${text}`;
      window.open(url, "_blank");
    }

    // --- عرض حالة الطلب مع لون ---
    function getStatusBadge(status) {
      let className = "";
      switch(status) {
        case STATUS_PENDING: className = "status-pending"; break;
        case STATUS_COMPLETED: className = "status-completed"; break;
        case STATUS_DELETED: className = "status-deleted"; break;
        default: className = "";
      }
      return `<span class="status-badge ${className}">${status}</span>`;
    }

    // --- تحديث جدول الطلبات في لوحة الإدارة ---
    function renderOrdersTable() {
      const orders = getOrders();
      ordersTableBody.innerHTML = "";
      if (orders.length === 0) {
        ordersTableBody.innerHTML = `<tr><td colspan="7" style="color:#999;">لا توجد طلبات حالياً</td></tr>`;
        return;
      }
      orders.forEach(order => {
        if(order.status === STATUS_DELETED) return; // لا تعرض المحذوفة
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${order.bookingNumber}</td>
          <td>${order.name}</td>
          <td>${order.phone}</td>
          <td style="text-align:right;">${order.issue.replace(/\n/g,"<br>")}</td>
          <td>${getStatusBadge(order.status)}</td>
          <td>
            <select data-booking="${order.bookingNumber}">
              <option value="${STATUS_PENDING}" ${order.status === STATUS_PENDING ? "selected" : ""}>قيد التنفيذ</option>
              <option value="${STATUS_COMPLETED}" ${order.status === STATUS_COMPLETED ? "selected" : ""}>مكتمل</option>
              <option value="${STATUS_DELETED}">محذوف</option>
            </select>
          </td>
          <td><button data-delete="${order.bookingNumber}" style="background:#d9534f; padding:6px 12px; font-size:0.9rem;">حذف</button></td>
        `;
        ordersTableBody.appendChild(tr);
      });
    }

    // --- تغيير حالة الطلب ---
    function changeOrderStatus(bookingNumber, newStatus) {
      const orders = getOrders();
      const index = orders.findIndex(o => o.bookingNumber === bookingNumber);
      if(index !== -1) {
        if(newStatus === STATUS_DELETED) {
          // حذف الطلب فعلياً
          orders.splice(index, 1);
        } else {
          orders[index].status = newStatus;
        }
        saveOrders(orders);
        renderOrdersTable();
      }
    }

    // --- التبديل بين التبويبات ---
    function switchTab(tab) {
      // إزالة الكلاس من الكل
      [tabBook, tabTrack, tabAdmin].forEach(t => t.classList.remove("active"));
      [sectionBook, sectionTrack, sectionAdmin].forEach(s => s.style.display = "none");

      // عرض القسم المناسب
      if(tab === "book") {
        tabBook.classList.add("active");
        sectionBook.style.display = "block";
      } else if(tab === "track") {
        tabTrack.classList.add("active");
        sectionTrack.style.display = "block";
      } else if(tab === "admin") {
        tabAdmin.classList.add("active");
        sectionAdmin.style.display = "block";
      }
    }

    // --- التحقق من كلمة مرور الإدارة ---
    function checkAdminPassword(password) {
      return password === ADMIN_PASSWORD;
    }

    // --- تسجيل دخول الإدارة ---
    function adminLogin(password) {
      if(checkAdminPassword(password)) {
        adminLoginForm.style.display = "none";
        adminPanel.style.display = "block";
        renderOrdersTable();
        alert("تم تسجيل الدخول بنجاح");
      } else {
        alert("كلمة المرور غير صحيحة");
      }
    }

    // --- تسجيل خروج الإدارة ---
    function adminLogout() {
      adminLoginForm.style.display = "block";
      adminPanel.style.display = "none";
      adminPasswordInput.value = "";
    }

    // --- متابعة حالة الطلب ---
    function trackOrder(bookingNumber) {
      const orders = getOrders();
      const order = orders.find(o => o.bookingNumber === bookingNumber);
      if(!order) {
        trackingResult.innerHTML = `<span style="color:#d9534f;">رقم الحجز غير موجود</span>`;
        return;
      }
      if(order.status === STATUS_DELETED) {
        trackingResult.innerHTML = `<span style="color:#d9534f;">هذا الطلب محذوف</span>`;
        return;
      }
      // يمكن إضافة حساب تقريبي للانتظار (مثلاً: حسب ترتيب الطلبات قيد التنفيذ)
      const pendingOrders = orders.filter(o => o.status === STATUS_PENDING);
      const position = pendingOrders.findIndex(o => o.bookingNumber === bookingNumber) + 1;
      let waitMsg = "";
      if(order.status === STATUS_PENDING) {
        waitMsg = `وضعك في قائمة الانتظار: ${position} من ${pendingOrders.length} طلبات قيد التنفيذ.`;
      } else if(order.status === STATUS_COMPLETED) {
        waitMsg = "تم الانتهاء من طلبك.";
      }
      trackingResult.innerHTML = `
        <p>رقم الحجز: <strong>${order.bookingNumber}</strong></p>
        <p>الحالة: ${getStatusBadge(order.status)}</p>
        <p>${waitMsg}</p>
      `;
    }

    // --- حدث حجز الطلب ---
    bookingForm.addEventListener("submit", e => {
      e.preventDefault();

      const name = bookingForm.name.value.trim();
      const phone = bookingForm.phone.value.trim();
      const email = bookingForm.email.value.trim();
      const issue = bookingForm.issue.value.trim();

      if(!name || !phone || !issue) {
        alert("يرجى ملء الحقول المطلوبة");
        return;
      }

      const bookingNumber = generateBookingNumber();

      const newOrder = {
        bookingNumber,
        name,
        phone,
        email,
        issue,
        status: STATUS_PENDING,
        createdAt: new Date().toISOString()
      };

      const orders = getOrders();
      orders.push(newOrder);
      saveOrders(orders);

      // تحويل إلى واتساب
      sendToWhatsApp(newOrder);

      alert(`تم حجز الطلب بنجاح\nرقم الحجز الخاص بك: ${bookingNumber}\nيمكنك متابعة الطلب باستخدام رقم الحجز.`);

      bookingForm.reset();
      switchTab("track");
      document.getElementById("trackingNumber").value = bookingNumber;
      trackOrder(bookingNumber);
    });

    // --- حدث متابعة الطلب ---
    trackForm.addEventListener("submit", e => {
      e.preventDefault();
      const bookingNumber = trackForm.trackingNumber.value.trim();
      if(!bookingNumber) {
        alert("يرجى إدخال رقم الحجز");
        return;
      }
      trackOrder(bookingNumber);
    });

    // --- حدث دخول لوحة الإدارة ---
    adminLoginForm.addEventListener("submit", e => {
      e.preventDefault();
      const password = adminPasswordInput.value.trim();
      if(!password) {
        alert("يرجى إدخال كلمة المرور");
        return;
      }
      adminLogin(password);
    });

    // --- حدث تغيير حالة الطلب ---
    ordersTableBody.addEventListener("change", e => {
      if(e.target.tagName === "SELECT") {
        const bookingNumber = e.target.getAttribute("data-booking");
        const newStatus = e.target.value;
        if(bookingNumber && newStatus) {
          changeOrderStatus(bookingNumber, newStatus);
        }
      }
    });

    // --- حدث حذف الطلب ---
    ordersTableBody.addEventListener("click", e => {
      if(e.target.tagName === "BUTTON" && e.target.hasAttribute("data-delete")) {
        const bookingNumber = e.target.getAttribute("data-delete");
        if(confirm("هل أنت متأكد من حذف هذا الطلب؟")) {
          changeOrderStatus(bookingNumber, STATUS_DELETED);
        }
      }
    });

    // --- حدث تسجيل خروج الإدارة ---
    logoutBtn.addEventListener("click", () => {
      adminLogout();
    });

    // --- التبديل بين التبويبات ---
    tabBook.addEventListener("click", () => switchTab("book"));
    tabTrack.addEventListener("click", () => switchTab("track"));
    tabAdmin.addEventListener("click", () => switchTab("admin"));

    // --- بدء الصفحة بالتبويب الأول ---
    switchTab("book");
  </script>

</body>
</html>
